<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentinel Cloud Vision | Nova Noir</title>
    <link rel="stylesheet" href="theme.css">
    <style>
        .dashboard-grid {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 1rem;
            padding: 1rem;
            height: 100vh;
        }

        .stream-view {
            background: #000;
            border: 1px solid var(--primary-red);
            position: relative;
            overflow: hidden;
        }

        .stream-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px;
            border-left: 2px solid var(--primary-red);
        }
    </style>
</head>

<body>
    <div class="dashboard-grid">
        <!-- Sidebar: Model Selection -->
        <aside class="nova-card">
            <h2 style="color: var(--primary-red)">MODELS</h2>
            <div id="model-list">
                <!-- Admin controlled list -->
                <div class="nova-card" style="margin-bottom: 0.5rem; cursor: pointer;">
                    ResNet-50 (Active)
                </div>
                <div class="nova-card" style="margin-bottom: 0.5rem; opacity: 0.5;">
                    YOLOv8 (Restricted)
                </div>
            </div>
        </aside>

        <!-- Main Stream View -->
        <main class="stream-view">
            <div class="stream-overlay">
                LIVE FEED: HD-STREAM-01 <br>
                <span style="color: var(--primary-red)">‚óè RECORDING</span>
            </div>
            <!-- Canvas/Video for stream -->
            <div style="display: flex; justify-content: center; align-items: center; height: 100%;">
                <p style="color: var(--text-secondary)">[ INGESTING STREAM... ]</p>
            </div>
        </main>

        <!-- Sidebar: Real-time Alerts & Video Generator -->
        <section class="nova-card" style="display: flex; flex-direction: column; gap: 1rem;">
            <div>
                <h2 style="color: var(--primary-red)">ALERTS</h2>
                <div id="alert-feed">
                    <!-- Dynamic alerts -->
                </div>
            </div>

            <div style="border-top: 1px solid var(--primary-red); padding-top: 1rem;">
                <h2 style="color: var(--primary-red)">VIDEO GENERATOR</h2>
                <textarea id="video-prompt" placeholder="Enter prompt..."
                    style="width: 100%; background: #000; color: #fff; border: 1px solid var(--primary-red); padding: 5px; margin-bottom: 5px;"></textarea>
                <button id="generate-video-btn"
                    style="width: 100%; background: var(--primary-red); color: #fff; border: none; padding: 5px; cursor: pointer;">GENERATE</button>
                <div id="video-result" style="margin-top: 10px; display: none;">
                    <video id="output-video" width="100%" controls style="border: 1px solid var(--primary-red);">
                        Your browser does not support the video tag.
                    </video>
                    <p id="generating-status" style="color: var(--primary-red); font-size: 0.8rem; display: none;">
                        GENERATING...</p>
                </div>
            </div>
        </section>
    </div>

    <script>
        document.getElementById('generate-video-btn').addEventListener('click', async () => {
            const prompt = document.getElementById('video-prompt').value;
            if (!prompt) return;

            const btn = document.getElementById('generate-video-btn');
            const resultDiv = document.getElementById('video-result');
            const videoElement = document.getElementById('output-video');
            const statusLabel = document.getElementById('generating-status');

            btn.disabled = true;
            resultDiv.style.display = 'block';
            videoElement.style.display = 'none';
            statusLabel.style.display = 'block';

            try {
                const response = await fetch('http://localhost:8000/generate-video', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: prompt })
                });

                if (!response.ok) throw new Error('Generation failed');

                const blob = await response.blob();
                const videoUrl = URL.createObjectURL(blob);

                videoElement.src = videoUrl;
                videoElement.style.display = 'block';
                statusLabel.style.display = 'none';
                videoElement.play();
            } catch (error) {
                console.error(error);
                statusLabel.innerText = 'ERROR';
            } finally {
                btn.disabled = false;
            }
        });
    </script>
</body>

</html>